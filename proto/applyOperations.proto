/**
 * This is the initial builder-based schema (v0.1). In future iterations, weâ€™ll need to extend the postTx message 
 * to support surrogate tx forwarding and daisy-chained execution semantics.
 *
 */

syntax = "proto3";

package apply.operations;

enum OperationType {
    UNKNOWN          = 0;
    ADD_ADMIN        = 1;
    APPEND_WHITELIST = 2;
    ADD_WRITER       = 3;
    REMOVE_WRITER    = 4;
    TX               = 5;
    ADD_INDEXER      = 6;
    REMOVE_INDEXER   = 7;
    BAN_WRITER       = 8;
}

message TxOperation {
    bytes tx   = 1;  // Transaction hash (unique identifier for the transaction)
    bytes ia   = 2;  // Address of the requesting node (used for signature verification)
    bytes iw   = 3;  // Writing key of the requesting node (external subnetwork)
    bytes in   = 4;  // Nonce of the requesting node
    bytes ch   = 5;  // Content hash (hash of the transaction's data)
    bytes is   = 6;  // Requester's signature
    bytes bs   = 7;  // External bootstrap contract
    bytes mbs  = 8;  // MSB bootstrap key
    bytes vs   = 9;  // Validator's signature
    bytes vn   = 10; // Validator's nonce
}

message BasicKeyOperation {
    bytes nonce = 1;
    bytes sig   = 2;
}

message ExtendedKeyOperation {
    bytes wk    = 1;
    bytes nonce = 2;
    bytes sig   = 3;
}

message Operation {
    OperationType type = 1;
    bytes address      = 2;

    oneof value {
        BasicKeyOperation      bko  = 3;
        ExtendedKeyOperation   eko  = 4;
        TxOperation            txo  = 5;
    }
}
