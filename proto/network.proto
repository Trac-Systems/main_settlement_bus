syntax = "proto3";

package network.v1;

enum MessageType {
    MESSAGE_TYPE_UNSPECIFIED = 0;
    MESSAGE_TYPE_LIVENESS_REQUEST = 1;
    MESSAGE_TYPE_LIVENESS_RESPONSE = 2;
    MESSAGE_TYPE_BROADCAST_TRANSACTION_REQUEST = 3;
    MESSAGE_TYPE_BROADCAST_TRANSACTION_RESPONSE = 4;
}


// Warning: Do not change the numeric values of existing enum fields. They are part of the public API.
// New values can be added, but existing values must never be renumbered or deleted.
enum ResultCode {
    RESULT_CODE_UNSPECIFIED = 0;
    RESULT_CODE_OK = 1;
    RESULT_CODE_INVALID_PAYLOAD = 2;
    RESULT_CODE_RATE_LIMITED = 3;
    RESULT_CODE_SIGNATURE_INVALID = 4;
    RESULT_CODE_UNEXPECTED_ERROR = 5;
    RESULT_CODE_TIMEOUT = 6;
    RESULT_CODE_NODE_HAS_NO_WRITE_ACCESS = 7;
    RESULT_CODE_TX_ACCEPTED_PROOF_UNAVAILABLE = 8;
    RESULT_CODE_NODE_OVERLOADED = 9;
    RESULT_CODE_TX_ALREADY_PENDING = 10;
}

message LivenessRequest {
    bytes nonce = 1;
    bytes signature = 2;
}

message LivenessResponse {
    bytes nonce = 1;
    bytes signature = 2;
    ResultCode result = 3;
}

message BroadcastTransactionRequest {
    bytes data = 1;
    bytes nonce = 2;
    bytes signature = 3;
}

message BroadcastTransactionResponse {
    bytes nonce = 1;
    bytes signature = 2;
    bytes proof = 3;
    uint64 appendedAt = 4;
    ResultCode result = 5;
}

message ProofData {
    bytes proof = 1;
    uint64 appendedAt = 2;
}

message MessageHeader {
    MessageType type = 1;
    string id = 2;
    uint64 timestamp = 3;
    oneof field {
        LivenessRequest                       liveness_request = 4;
        LivenessResponse                      liveness_response = 5;
        BroadcastTransactionRequest           broadcast_transaction_request = 6;
        BroadcastTransactionResponse          broadcast_transaction_response = 7;
    }
    repeated string capabilities = 8;
}
