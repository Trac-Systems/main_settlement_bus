syntax = "proto3";

package network.v1;

enum MessageType {
    MESSAGE_TYPE_UNSPECIFIED = 0;
    MESSAGE_TYPE_VALIDATOR_CONNECTION_REQUEST = 1;
    MESSAGE_TYPE_VALIDATOR_CONNECTION_RESPONSE = 2;
    MESSAGE_TYPE_LIVENESS_REQUEST = 3;
    MESSAGE_TYPE_LIVENESS_RESPONSE = 4;
    MESSAGE_TYPE_BROADCAST_TRANSACTION_REQUEST = 5;
    MESSAGE_TYPE_BROADCAST_TRANSACTION_RESPONSE = 6;
}

enum ResultCode {
    RESULT_CODE_UNSPECIFIED = 0;
    RESULT_CODE_OK = 1;
    RESULT_CODE_INVALID_PAYLOAD = 2;
    RESULT_CODE_UNSUPPORTED_VERSION = 3;
    RESULT_CODE_RATE_LIMITED = 4;
    RESULT_CODE_TIMEOUT = 5;
    RESULT_CODE_SIGNATURE_INVALID = 6;
}

message ValidatorConnectionRequest {
    string issuer_address = 1;
    bytes nonce = 2;
    bytes signature = 3;
}

message ValidatorConnectionResponse {
    string issuer_address = 1;
    bytes nonce = 2;
    bytes signature = 3;
    ResultCode result = 4;
}

message LivenessRequest {
    bytes nonce = 1;
    bytes signature = 2;
}

message LivenessResponse {
    bytes nonce = 1;
    bytes signature = 2;
    ResultCode result = 3;
}

message BroadcastTransactionRequest {
    bytes data = 1; // binary encoded payload
    bytes nonce = 2;
    bytes signature = 3;
}

message BroadcastTransactionResponse {
    bytes nonce = 1;
    bytes signature = 2;
    ResultCode result = 3;
}

message MessageHeader {
    MessageType type = 1;
    uint64 session_id = 2;
    uint64 timestamp = 3;
    oneof field {
        ValidatorConnectionRequest            validator_connection_request  = 4;
        ValidatorConnectionResponse           validator_connection_response  = 5;
        LivenessRequest                       liveness_request = 6;
        LivenessResponse                      liveness_response = 7;
        BroadcastTransactionRequest           broadcast_transaction_request = 8;
        BroadcastTransactionResponse          broadcast_transaction_response = 9;
    }
    repeated string capabilities = 10;
}
